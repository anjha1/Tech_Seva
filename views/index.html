
<!DOCTYPE html>
<html lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechSeva - Connecting Bharat to Trusted Local Technicians</title>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Tailwind CSS (optional, if you want to use Tailwind classes directly, otherwise your custom CSS is detailed) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/styleindex.css">

    <!-- Google Identity Services Library -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <!-- Header -->
    <header>
        <a href="#" class="logo">
            <span class="logo-icon">ðŸ”§</span> TechSeva
        </a>
        <button class="menu-toggle" id="menu-toggle">â˜°</button>
        <nav class="nav-menu" id="main-nav-menu">
            <li class="nav-item"><a href="/" class="active">Home</a></li>
            <li class="nav-item"><a href="working.html">How It Works</a></li>
            <li class="nav-item"><a href="contact.html">Contact</a></li>
            
            <li class="nav-item"><a href="javascript:void(0)" id="login-nav-btn">Login/Signup</a></li>
        </nav>
    </header>

    <main>
    <!-- Hero Section -->
    <section class="hero" id="home">
        <!-- <video autoplay muted loop playsinline class="hero-video">
            <source src="https://assets.mixkit.co/videos/preview/mixkit-technician-repairing-a-computer-while-a-woman-watches-43732-large.mp4" type="video/mp4">
        </video> -->
        <!-- <div class="hero-video-container">
            <iframe 
            src="https://www.youtube.com/embed/0L_Srf8wmEw?autoplay=1&mute=1&loop=1&controls=0&playlist=0L_Srf8wmEw" 
            frameborder="0" 
            allow="autoplay; encrypted-media" 
            class="hero-video">
            </iframe>
        </div> -->
        <video autoplay muted loop playsinline class="hero-video">
  <source src="/videos/Ac_ad.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <h1>Your Devices, Our Care</h1>
            <p>Fast, trusted repair & tech support at your doorstep</p>
            <div class="cta-buttons">
                <a href="#unauthenticated-book-service" class="btn btn-primary" id="scroll-to-book-service"><i class="fas fa-calendar-alt"></i> Book a Repair</a>
                <a href="javascript:void(0)" id="join-tech-btn" class="btn btn-secondary"><i class="fas fa-user-plus"></i> Join as Technician</a>
            </div>
            <!-- <div class="search-box">
                <input type="text" placeholder="Enter device or issue (e.g., iPhone screen repair)...">
                <button><i class="fas fa-search"></i> Search</button>
                <div class="device-suggestions">
                    <div class="device-suggestion"><i class="fas fa-mobile-alt"></i> Smartphone Repair</div>
                    <div class="device-suggestion"><i class="fas fa-laptop"></i> Laptop Repair</div>
                    <div class="device-suggestion"><i class="fas fa-tv"></i> TV & AC Service</div>
                    <div class="device-suggestion"><i class="fas fa-shield-alt"></i> Extended Warranty</div>
                </div>
            </div> -->
        </div>

    </section>
     <section class="appliance-repair">
        <div class="container">
            <div class="section-title">
                <h2>Appliance Repair Services</h2>
                <p>Professional repair services for all your home appliances by certified technicians</p>
            </div>
            
            <div class="services-grid">
                <!-- AC Repair -->
                <div class="service-card">
                    <div class="service-image">
                        <img src="/images/ACRepair.png" alt="AC Repair Service">
                    </div>
                    <div class="service-content">
                        <h3 class="service-title">AC Repair & Service</h3>
                        <p class="service-description">Professional AC servicing, gas refilling, and repair for all brands</p>
                        <ul class="service-features">
                            <li><i class="fas fa-check"></i> Cooling issue resolution</li>
                            <li><i class="fas fa-check"></i> Gas leak detection & repair</li>
                            <li><i class="fas fa-check"></i> Compressor servicing</li>
                        </ul>
                        <a href="#unauthenticated-book-service" class="select-service-btn">Select Service</a>
                    </div>
                </div>
                
                <!-- Refrigerator Repair -->
                <div class="service-card">
                    <div class="service-image">
                        <img src="/images/RefrigeratorRepair.png" alt="Refrigerator Repair Service">
                    </div>
                    <div class="service-content">
                        <h3 class="service-title">Refrigerator Repair</h3>
                        <p class="service-description">Expert fridge and freezer repair with genuine replacement parts</p>
                        <ul class="service-features">
                            <li><i class="fas fa-check"></i> Cooling system repair</li>
                            <li><i class="fas fa-check"></i> Compressor issues</li>
                            <li><i class="fas fa-check"></i> Door seal replacement</li>
                        </ul>
                        <a href="#unauthenticated-book-service" class="select-service-btn">Select Service</a>
                    </div>
                </div>
                
                <!-- Washing Machine -->
                <div class="service-card">
                    <div class="service-image">
                        <img src="/images/WashingMachineRepair.png" alt="Washing Machine Repair Service">
                    </div>
                    <div class="service-content">
                        <h3 class="service-title">Washing Machine Repair</h3>
                        <p class="service-description">Expert repair for washing machines, dryers, and all laundry appliances</p>
                        <ul class="service-features">
                            <li><i class="fas fa-check"></i> Drum and motor repairs</li>
                            <li><i class="fas fa-check"></i> Water leakage fixes</li>
                            <li><i class="fas fa-check"></i> Spin cycle issues</li>
                        </ul>
                        <a href="#unauthenticated-book-service" class="select-service-btn">Select Service</a>
                    </div>
                </div>
                
                <!-- Geyser Repair -->
                <div class="service-card">
                    <div class="service-image">
                        <img src="/images/GeyserRepair.png" alt="Geyser Repair Service">
                    </div>
                    <div class="service-content">
                        <h3 class="service-title">Geyser Repair</h3>
                        <p class="service-description">Professional geyser repair and maintenance services</p>
                        <ul class="service-features">
                            <li><i class="fas fa-check"></i> Heating element replacement</li>
                            <li><i class="fas fa-check"></i> Thermostat issues</li>
                            <li><i class="fas fa-check"></i> Leakage problems</li>
                        </ul>
                        <a href="#unauthenticated-book-service" class="select-service-btn">Select Service</a>
                    </div>
                </div>
                
                <!-- Fan Repair -->
                <div class="service-card">
                    <div class="service-image">
                        <img src="/images/FanRepair.png" alt="Fan Repair Service">
                    </div>
                    <div class="service-content">
                        <h3 class="service-title">Fan Repair</h3>
                        <p class="service-description">Comprehensive fan repair services for all types of fans</p>
                        <ul class="service-features">
                            <li><i class="fas fa-check"></i> Motor repair and replacement</li>
                            <li><i class="fas fa-check"></i> Speed control issues</li>
                            <li><i class="fas fa-check"></i> Blade balancing</li>
                        </ul>
                        <a href="#unauthenticated-book-service" class="select-service-btn">Select Service</a>
                    </div>
                </div>
                
                <!-- Computer Repair -->
                <div class="service-card">
                    <div class="service-image">
                        <img src="/images/ComputerRepair.png" alt="Computer Repair Service">
                    </div>
                    <div class="service-content">
                        <h3 class="service-title">Computer Repair</h3>
                        <p class="service-description">Expert computer repair and maintenance services</p>
                        <ul class="service-features">
                            <li><i class="fas fa-check"></i> Hardware troubleshooting</li>
                            <li><i class="fas fa-check"></i> Software installation</li>
                            <li><i class="fas fa-check"></i> Virus removal</li>
                        </ul>
                        <a href="#unauthenticated-book-service" class="select-service-btn">Select Service</a>
                    </div>
                </div>
                
                <!-- Laptop Repair -->
                <div class="service-card">
                    <div class="service-image">
                        <img src="/images/LaptopRepair.png" alt="Laptop Repair Service">
                    </div>
                    <div class="service-content">
                        <h3 class="service-title">Laptop Repair</h3>
                        <p class="service-description">Professional laptop repair services for all brands</p>
                        <ul class="service-features">
                            <li><i class="fas fa-check"></i> Screen replacement</li>
                            <li><i class="fas fa-check"></i> Keyboard issues</li>
                            <li><i class="fas fa-check"></i> Battery replacement</li>
                        </ul>
                        <a href="#unauthenticated-book-service" class="select-service-btn">Select Service</a>
                    </div>
                </div>
                
                <!-- Mobile Phone Repair -->
                <div class="service-card">
                    <div class="service-image">
                        <img src="/images/MobilePhoneRepair.png" alt="Mobile Phone Repair Service">
                    </div>
                    <div class="service-content">
                        <h3 class="service-title">Mobile Phone Repair</h3>
                        <p class="service-description">Expert mobile phone repair services for all models</p>
                        <ul class="service-features">
                            <li><i class="fas fa-check"></i> Screen replacement</li>
                            <li><i class="fas fa-check"></i> Battery issues</li>
                            <li><i class="fas fa-check"></i> Software problems</li>
                        </ul>
                        <a href="#unauthenticated-book-service" class="select-service-btn">Select Service</a>
                    </div>
                </div>
                
                <!-- Dishwasher Repair -->
                <div class="service-card">
                    <div class="service-image">
                        <img src="/images/DishwasherRepair.png" alt="Dishwasher Repair Service">
                    </div>
                    <div class="service-content">
                        <h3 class="service-title">Dishwasher Repair</h3>
                        <p class="service-description">Professional dishwasher repair and maintenance</p>
                        <ul class="service-features">
                            <li><i class="fas fa-check"></i> Pump and motor issues</li>
                            <li><i class="fas fa-check"></i> Drainage problems</li>
                            <li><i class="fas fa-check"></i> Control panel repair</li>
                        </ul>
                        <a href="#unauthenticated-book-service" class="select-service-btn">Select Service</a>
                    </div>
                </div>
                
                <!-- Inverter/Battery Repair -->
                <div class="service-card">
                    <div class="service-image">
                        <img src="/images/InverterBatteryRepair.png" alt="Inverter/Battery Repair Service">
                    </div>
                    <div class="service-content">
                        <h3 class="service-title">Inverter/Battery Repair</h3>
                        <p class="service-description">Expert inverter and battery repair services</p>
                        <ul class="service-features">
                            <li><i class="fas fa-check"></i> Battery replacement</li>
                            <li><i class="fas fa-check"></i> Charging issues</li>
                            <li><i class="fas fa-check"></i> Circuit board repair</li>
                        </ul>
                        <a href="#unauthenticated-book-service" class="select-service-btn">Select Service</a>
                    </div>
                </div>
                
                <!-- General Electrical Work -->
                <div class="service-card">
                    <div class="service-image">
                        <img src="/images/GeneralElectricalWork.png" alt="General Electrical Work Service">
                    </div>
                    <div class="service-content">
                        <h3 class="service-title">General Electrical Work</h3>
                        <p class="service-description">Comprehensive electrical repair and installation services</p>
                        <ul class="service-features">
                            <li><i class="fas fa-check"></i> Wiring and rewiring</li>
                            <li><i class="fas fa-check"></i> Switchboard repair</li>
                            <li><i class="fas fa-check"></i> Lighting installation</li>
                        </ul>
                        <a href="#unauthenticated-book-service" class="select-service-btn">Select Service</a>
                    </div>
                </div>
            </div>
        </div>
    </section>
      

    <!-- Why Choose Us Section -->
    <div class="section-container">
        <section class="why-choose">
            <div class="floating-devices" id="floating-devices"></div>
            <div class="container">
                <div class="section-title">
                    <h2>Why Choose TechSeva?</h2>
                    <p>We're committed to providing the best service experience in the industry</p>
                </div>
                <div class="benefits">
                    <div class="benefit-item">
                        <div class="benefit-icon">
                            <div class="benefit-image">
                                <img src="/images/MobilePhoneRepair.png" alt="Fast Turnaround">
                            </div>
                        </div>
                        <h3>Fast Turnaround</h3>
                        <p>Most repairs completed in under 2 hours at your location with our mobile service vans.</p>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">
                            <div class="benefit-image">
                                <img src="/images/ComputerRepair.png" alt="Certified Experts">
                            </div>
                        </div>
                        <h3>Certified Experts</h3>
                        <p>Our technicians are trained and certified by leading brands like Apple, Samsung, and Dell.</p>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">
                            <div class="benefit-image">
                                <img src="/images/InverterBatteryRepair.png" alt="Transparent Pricing">
                            </div>
                        </div>
                        <h3>Transparent Pricing</h3>
                        <p>No hidden costs. Get upfront quotes with 90-day warranty on all repairs.</p>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">
                            <div class="benefit-image">
                                <img src="/images/GeneralElectricalWork.png" alt="Wide Coverage">
                            </div>
                        </div>
                        <h3>Wide Coverage</h3>
                        <p>Serving in 50+ cities across India with 1000+ skilled technicians.</p>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">
                            <div class="benefit-image">
                                <img src="/images/GeyserRepair.png" alt="24/7 Support">
                            </div>
                        </div>
                        <h3>24/7 Support</h3>
                        <p>Round-the-clock customer support via chat, phone and email for all your queries.</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Service Process Section -->
    <div class="section-container">
        <section class="service-process">
            
                
                <div class="section-title">
                    <h2>Our Platform Features</h2>
                    <p>Designed for Tier-2 & Tier-3 Towns across India</p>
                </div>
                
                <div class="features-grid">
                    <div class="feature-item">
                        <div class="feature-image">
                            <img src="/images/ACRepair.png" alt="App & IVR Booking">
                        </div>
                        <h3>App & IVR Booking</h3>
                        <p>Seamless booking via our mobile app for smartphone users and a dedicated IVR phone system for feature phone users.</p>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-image">
                            <img src="/images/RefrigeratorRepair.png" alt="Image-Based Diagnosis">
                        </div>
                        <h3>Image-Based Diagnosis</h3>
                        <p>Technicians upload images showing the actual problem before quoting, ensuring transparency and accuracy.</p>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-image">
                            <img src="/images/DishwasherRepair.png" alt="Dynamic Pricing">
                        </div>
                        <h3>Dynamic Pricing</h3>
                        <p>Prices adjust based on parts needed, travel distance, and job complexity, providing fair and transparent costs.</p>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-image">
                            <img src="/images/FanRepair.png" alt="Regional Language Support">
                        </div>
                        <h3>Regional Language Support</h3>
                        <p>Our platform is available in Hindi, Tamil, Telugu, Bengali, and other regional languages for broader accessibility.</p>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-image">
                            <img src="/images/LaptopRepair.png" alt="Verified Technicians">
                        </div>
                        <h3>Verified Technicians</h3>
                        <p>All technicians undergo rigorous background checks and skill verification to ensure trusted and reliable service.</p>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-image">
                            <img src="/images/QRCode.png" alt="Digital Invoices">
                        </div>
                        <h3>Digital Invoices</h3>
                        <p>Receive detailed invoices with warranty information instantly via app, SMS, or email for every service.</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Simple animation for the floating devices
        document.addEventListener('DOMContentLoaded', function() {
            const floatingDevices = document.getElementById('floating-devices');
            if (floatingDevices) {
                let position = 0;
                let direction = 1;
                
                setInterval(() => {
                    position += direction * 0.5;
                    if (position > 10 || position < -10) {
                        direction *= -1;
                    }
                    floatingDevices.style.transform = `translateY(${position}px)`;
                }, 100);
            }
        });
    </script>

   

    <!-- Booking Service Section for Unauthenticated/Authenticated Users -->
   <!-- Booking Service Section for Unauthenticated/Authenticated Users -->
<section id="unauthenticated-book-service" class="booking-section">
    <div class="container">
        <div class="section-title">
            <h2>Book a Service</h2>
            <p>Fill out the details below to book your service. If you're not logged in, you'll be prompted to do so.</p>
        </div>
        <form id="unauthenticated-booking-form">
            <div class="form-group">
                <label for="unauth-appliance-type">Select Appliance Type:</label>
                <select id="unauth-appliance-type" name="applianceType" required>
                    <option value="">-- Select --</option>
                    <option value="AC">AC Repair/Service</option>
                    <option value="Refrigerator">Refrigerator Repair</option>
                    <option value="Washing Machine">Washing Machine Repair</option>
                    <option value="TV">TV Repair</option>
                    <option value="Fan">Fan Repair</option>
                    <option value="Geyser">Geyser Repair</option>
                    <option value="Microwave">Microwave Repair</option>
                    <option value="Water Purifier">Water Purifier Repair</option>
                    <option value="Dishwasher">Dishwasher Repair</option>
                    <option value="Inverter">Inverter/Battery Repair</option>
                    <option value="Computer">Computer Repair</option>
                    <option value="Laptop">Laptop Repair</option>
                    <option value="Mobile">Mobile Phone Repair</option>
                    <option value="Electrical">General Electrical Work</option>
                    <option value="Plumbing">Plumbing Services</option>
                    <option value="Carpentry">Carpentry Services</option>
                    <option value="Painting">Painting Services</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <button type="submit" id="unauth-book-service-btn" class="btn btn-primary btn-form-submit">Book Service</button>
        </form>
    </div>
</section>


    <!-- AI Diagnosis Section -->
    <section id="ai-diagnosis-section" class="ai-diagnosis-section">
            <div class="container">
                <h2>âœ¨ AI Appliance Diagnoser âœ¨</h2>
                <p>Describe your appliance's problem and get an instant preliminary diagnosis from our AI. This can help you understand the issue better before booking a service.</p>
                <div class="form-group">
                    <label for="appliance-problem">What's wrong with your appliance?</label>
                    <textarea id="appliance-problem" placeholder="e.g., My refrigerator is not cooling, but the light is on."></textarea>
                </div>
                <button id="get-diagnosis-btn" class="btn btn-primary">Get AI Diagnosis âœ¨</button>
                <div id="diagnosis-result" class="diagnosis-result" style="display: none;">
                    <!-- AI Diagnosis will be displayed here -->
                </div>
                <p id="loading-indicator" style="display: none;">Diagnosing problem... Please wait.</p>
            </div>
        </section>

    <!-- Fare Prediction Section -->
    <section id="fare-prediction-section" class="fare-prediction-section">
        <div class="container">
            <h2>ðŸ’° Travel Fee Prediction</h2>
            <p>Estimate the travel charges for a technician's visit from their location to your home.</p>
            <form id="fare-prediction-form">
                <div class="form-group">
                    <label for="technician-location">Technician's Location:</label>
                    <div id="technician-location-mount-point"></div>
                    <input type="hidden" id="technician-lat" name="technician_lat">
                    <input type="hidden" id="technician-lon" name="technician_lon">
                </div>
                <div class="form-group">
                    <label for="user-location">Your Location:</label>
                    <div id="user-location-mount-point"></div>
                    <input type="hidden" id="user-lat" name="user_lat">
                    <input type="hidden" id="user-lon" name="user_lon">
                </div>
                <div class="form-group">
                    <label for="visit-datetime">Visit Date & Time:</label>
                    <input type="datetime-local" id="visit-datetime" name="datetime" required>
                </div>
                <button type="submit" id="predict-fare-btn" class="btn btn-primary">Predict Travel Fee</button>
            </form>
            <div id="fare-result" class="fare-result" style="display: none;">
                <!-- Fare prediction will be displayed here -->
            </div>
            <p id="fare-loading-indicator" style="display: none;">Calculating fare... Please wait.</p>
        </div>
    </section>

    <!-- Join as Partner Section -->
    <section class="join-section" id="join">
        <div class="container">
            <h2>Fix & Earn with TechSeva</h2>
            <p>Join our network of certified technicians and get flexible work opportunities with daily payouts</p>
            <div class="benefits-list">
                <div class="benefit-tag">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Flexible Schedule</span>
                </div>
                <div class="benefit-tag">
                    <i class="fas fa-wallet"></i>
                    <span>Daily Payouts</span>
                </div>
                <div class="benefit-tag">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Free Training</span>
                </div>
                <div class="benefit-tag">
                    <i class="fas fa-tools"></i>
                    <span>Toolkit Provided</span>
                </div>
                <div class="benefit-tag">
                    <i class="fas fa-users"></i>
                    <span>Support Team</span>
                </div>
                <div class="benefit-tag">
                    <i class="fas fa-chart-line"></i>
                    <span>Growth Opportunities</span>
                </div>
            </div>
            <a href="javascript:void(0)" id="join-tech-btn-bottom" class="btn btn-primary"><i class="fas fa-user-plus"></i> Become a Technician</a>
        </div>
    </section>

    <!-- Pricing Comparison Section -->
    <div class="section-container">
        <section class="pricing-comparison">
            <div class="container">
                <div class="section-title">
                    <h2>Static vs Dynamic Pricing</h2>
                    <p>Understanding how our pricing model benefits both customers and service providers</p>
                </div>
                
                <div class="comparison-intro">
                    <p>Traditional service companies often use static pricing models that don't account for variations in repair complexity, parts availability, or technician expertise. TechSeva's dynamic pricing model ensures fair pricing for customers while maintaining profitability for our technicians.</p>
                </div>
                
                <div class="comparison-content">
                    <div class="pricing-model static-pricing">
                        <div class="model-header">
                            <div class="model-icon">
                                <img src="/images/InverterBatteryRepair.png" alt="Static Pricing">
                            </div>
                            <h3 class="model-title">Static Pricing</h3>
                        </div>
                        <ul class="model-features">
                            <li>Fixed rates regardless of actual repair complexity</li>
                            <li>One-size-fits-all approach to service costs</li>
                            <li>Often includes hidden fees and charges</li>
                            <li>No consideration for parts availability or cost fluctuations</li>
                            <li>Limited flexibility for customer budget constraints</li>
                            <li>Often leads to either overcharging or undercharging</li>
                        </ul>
                        <p><strong>Result:</strong> Inefficient pricing that often doesn't reflect the true value of service provided.</p>
                    </div>
                    
                    <div class="pricing-model dynamic-pricing">
                        <div class="model-header">
                            <div class="model-icon">
                                <img src="/images/ComputerRepair.png" alt="Dynamic Pricing">
                            </div>
                            <h3 class="model-title">Dynamic Pricing</h3>
                        </div>
                        <ul class="model-features">
                            <li>Real-time pricing based on actual parts and labor required</li>
                            <li>Transparent cost breakdown before any work begins</li>
                            <li>Considers technician expertise and certification levels</li>
                            <li>Accounts for part availability and market prices</li>
                            <li>Flexible options for different quality tiers of parts</li>
                            <li>Distance-based travel fee calculation</li>
                        </ul>
                        <p><strong>Result:</strong> Fair pricing that accurately reflects the specific service requirements.</p>
                    </div>
                </div>
                
                <div class="profit-section">
                    <div class="profit-image">
                        <img src="/images/MobilePhoneRepair.png" alt="Profit with Dynamic Pricing">
                    </div>
                    <div class="profit-content">
                        <h3>Increased Profit with Dynamic Pricing</h3>
                        <ul class="profit-points">
                            <li><strong>Optimized Resource Allocation:</strong> Dynamic pricing ensures technicians are compensated fairly for their specific expertise and time investment.</li>
                            <li><strong>Reduced Customer Disputes:</strong> Transparent pricing leads to higher customer satisfaction and fewer payment issues.</li>
                            <li><strong>Better Inventory Management:</strong> Real-time part pricing helps maintain optimal inventory levels and reduces waste.</li>
                            <li><strong>Competitive Advantage:</strong> Fair and transparent pricing attracts more customers and builds brand loyalty.</li>
                            <li><strong>Increased Service Volume:</strong> Satisfied customers are more likely to return and refer others, increasing overall revenue.</li>
                        </ul>
                    </div>
                </div>
                
                <div class="visual-comparison">
                    <h3 class="section-subtitle" style="text-align: center; margin-bottom: 30px;">Pricing Model Comparison</h3>
                    <div class="comparison-chart">
                        <div class="chart-bar">
                            <div class="bar static-bar">
                                <div class="bar-label">Static Pricing</div>
                            </div>
                            <div class="chart-label">Customer Satisfaction: 65%</div>
                        </div>
                        <div class="chart-bar">
                            <div class="bar dynamic-bar">
                                <div class="bar-label">Dynamic Pricing</div>
                            </div>
                            <div class="chart-label">Customer Satisfaction: 92%</div>
                        </div>
                        <div class="chart-bar">
                            <div class="bar static-bar" style="height: 70%;">
                                <div class="bar-label">Static Pricing</div>
                            </div>
                            <div class="chart-label">Technician Profit Margin: 22%</div>
                        </div>
                        <div class="chart-bar">
                            <div class="bar dynamic-bar" style="height: 90%;">
                                <div class="bar-label">Dynamic Pricing</div>
                            </div>
                            <div class="chart-label">Technician Profit Margin: 35%</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Simple animation for chart bars
        document.addEventListener('DOMContentLoaded', function() {
            const bars = document.querySelectorAll('.bar');
            bars.forEach(bar => {
                const height = bar.style.height;
                bar.style.height = '0';
                setTimeout(() => {
                    bar.style.transition = 'height 1s ease-in-out';
                    bar.style.height = height;
                }, 500);
            });
        });
    </script>
    <!-- App Download Section -->
    <section class="app-section">
    <div class="container">
        <div class="section-title">
            <h2>TechSeva Mobile App</h2>
            <p>Track your repair, chat with experts & shop on the go</p>
        </div>
        <div class="app-content">
            <div class="app-image">
                <img src="/images/TechSevaMobileApp.png" alt="TechSeva Mobile App">
            </div>
            <div class="app-details">
                <h3>Everything you need in one app</h3>
                <p>Our mobile app makes it easy to book services, track repair status in real-time, chat with technicians, and purchase accessories - all from your smartphone.</p>
                
                <div class="app-features">
                    <div class="app-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Real-time repair tracking</span>
                    </div>
                    <div class="app-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Instant quotes for services</span>
                    </div>
                    <div class="app-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Chat directly with technicians</span>
                    </div>
                    <div class="app-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Exclusive app-only discounts</span>
                    </div>
                </div>
                
                <div class="app-badges">
                    <img src="/images/GooglePlay.png" alt="Google Play" class="app-badge">
                    <img src="/images/AppStore.png" alt="App Store" class="app-badge">
                </div>
                
                <div class="qr-container">
                    <img src="/images/QRCode.png" alt="QR Code" class="qr-code">
                    <div class="qr-text">Scan to download the TechSeva app directly to your device</div>
                </div>
            </div>
        </div>
    </div>
</section>

    <!-- User Types CTA Section (from index1.html) -->
    <section class="user-types-cta-section">
        <div class="container">
            <div class="section-title">
                <h2>Who Are You?</h2>
            </div>
            <div class="user-cta-grid">
                <a href="javascript:void(0)" class="user-cta-card customer" id="customer-cta-btn">
                    <h3><span class="user-icon">ðŸ‘¤</span> I am a Customer</h3>
                    <p>Need a quick and reliable appliance repair? Book a service now!</p>
                    <button class="btn btn-primary" style="margin-top: 20px;">Book Service</button>
                </a>
                <a href="javascript:void(0)" class="user-cta-card technician" id="technician-cta-btn">
                    <h3><span class="user-icon">ðŸ‘·</span> I am a Technician</h3>
                    <p>Grow your business, get more jobs, and earn more with TechSeva.</p>
                    <button class="btn btn-primary" style="margin-top: 20px;">Join Now</button>
                </a>
                <a href="https://tech-seva.onrender.com/admin-login" class="user-cta-card admin" id="admin-cta-btn">
                    <h3><span class="user-icon">ðŸ‘‘</span> I am an Admin</h3>
                    <p>Manage users, jobs, and platform operations efficiently.</p>
                    <button class="btn btn-primary" style="margin-top: 20px;">Access Admin</button>
                </a>
            </div>
        </div>
    </section>

  

    <!-- Testimonials Section -->
    <section class="testimonials" id="testimonials">
        <div class="container">
            <div class="section-title">
                <h2>What Our Customers Say</h2>
                <p>Hear from people who trusted TechSeva with their devices</p>
            </div>
            <div class="testimonial-slider">
                <div class="testimonial-track">
                    <div class="testimonial-card">
                        <div class="testimonial-avatar">
                            <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Rahul Sharma">
                        </div>
                        <p class="testimonial-text">"My iPhone screen was repaired in just 45 minutes at my office. The technician was professional and the quality is perfect! I've used their service three times now and it's consistently excellent."</p>
                        <h4 class="testimonial-author">Rahul Sharma</h4>
                        <p class="testimonial-role">Delhi | Marketing Executive</p>
                        <div class="testimonial-rating">â˜…â˜…â˜…â˜…â˜…</div>
                    </div>
                    <div class="testimonial-card">
                        <div class="testimonial-avatar">
                            <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="Priya Patel">
                        </div>
                        <p class="testimonial-text">"Great service! My laptop was fixed the same day and they even gave me tips to maintain it better. The pricing was transparent and much cheaper than the brand service center."</p>
                        <h4 class="testimonial-author">Priya Patel</h4>
                        <p class="testimonial-role">Mumbai | College Student</p>
                        <div class="testimonial-rating">â˜…â˜…â˜…â˜…â˜…</div>
                    </div>
                    <div class="testimonial-card">
                        <div class="testimonial-avatar">
                            <img src="https://randomuser.me/api/portraits/men/75.jpg" alt="Vikram Singh">
                        </div>
                        <p class="testimonial-text">"As a partner technician, I'm earning more than my previous shop job with flexible hours. The support team is always helpful and payments come on time every day."</p>
                        <h4 class="testimonial-author">Vikram Singh</h4>
                        <p class="testimonial-role">TechSeva Partner | Bangalore</p>
                        <div class="testimonial-rating">â˜…â˜…â˜…â˜…â˜…</div>
                    </div>
                    <div class="testimonial-card">
                        <div class="testimonial-avatar">
                            <img src="https://randomuser.me/api/portraits/women/68.jpg" alt="Ananya Gupta">
                        </div>
                        <p class="testimonial-text">"The technician arrived exactly on time and fixed my washing machine in under an hour. The app made it so easy to book and track the service. Highly recommended!"</p>
                        <h4 class="testimonial-author">Ananya Gupta</h4>
                        <p class="testimonial-role">Hyderabad | Homemaker</p>
                        <div class="testimonial-rating">â˜…â˜…â˜…â˜…â˜†</div>
                    </div>
                </div>
                <div class="slider-nav">
                    <!-- <div class="slider-dot active"></div> -->
                    <!-- <div class="slider-dot"></div>
                    <div class="slider-dot"></div>
                    <div class="slider-dot"></div> -->
                </div>
            </div>
        </div>
    </section>

    <!-- FAQ Section -->
    <section class="faq" id="faq-section">
        <div class="container">
            <div class="section-title">
                <h2>Frequently Asked Questions</h2>
                <p>Find quick answers to common questions about our services</p>
            </div>
            <div class="faq-container">
                <div class="faq-item">
                    <div class="faq-question">
                        <span>How quickly can you repair my device?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Most common repairs like screen replacements are completed within 1-2 hours at your location. For more complex issues, we provide a diagnosis within 30 minutes and will give you an accurate time estimate.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <span>Are your technicians certified?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Yes, all our technicians undergo rigorous training and are certified by leading brands. We also conduct regular skill assessments to ensure the highest quality of service.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <span>What warranty do you provide on repairs?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>All repairs come with a 90-day warranty on both parts and labor. For screen replacements, we offer a 180-day warranty.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <span>How do I become a TechSeva technician?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Visit our "Become a Technician" section to apply. We provide free training, tools, and flexible earning opportunities. Basic technical knowledge is required.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        <span>Do you use genuine parts for repairs?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>We use OEM (Original Equipment Manufacturer) parts that meet or exceed original specifications. You can choose between premium OEM parts or more affordable high-quality alternatives.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- City Coverage Section -->
       
    </section>
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-wave"></div>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>TechSeva</h3>
                    <p>India's most trusted tech service and repair platform, bringing expert solutions to your doorstep.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Services</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Smartphone Repair</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Laptop Repair</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> TV & AC Service</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Extended Warranty</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Accessories Shop</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Company</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fas fa-chevron-right"></i> About Us</a></li>
                        <li><a href="https://techseva-careers.onrender.com/careers"><i class="fas fa-chevron-right"></i> Careers</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Blog</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Press</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Partner With Us</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Support</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Help Center</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Contact Us</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Privacy Policy</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Terms of Service</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i> FAQ</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Newsletter</h3>
                    <div class="newsletter">
                        <p>Subscribe to get updates on offers and tech tips</p>
                        <form class="newsletter-form">
                            <input type="email" placeholder="Your email address">
                            <button type="submit"><i class="fas fa-paper-plane"></i></button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
    <div class="payment-methods">
        <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/Visa_Logo.png" alt="Visa" class="payment-method">
        <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" alt="Mastercard" class="payment-method">
        <img src="https://upload.wikimedia.org/wikipedia/commons/e/eb/Paytm_Logo_%28standalone%29.svg" alt="Paytm" class="payment-method">
        <img src="https://upload.wikimedia.org/wikipedia/commons/e/e1/UPI-Logo-vector.svg" alt="UPI" class="payment-method">
        <img src="https://upload.wikimedia.org/wikipedia/commons/3/30/American_Express_logo.svg" alt="Amex" class="payment-method">
    </div>
    <p>&copy; 2023 TechSeva Technologies Pvt Ltd. All rights reserved.</p>
</div>

        </div>
    </footer>

    <!-- Auth Overlay and Modals -->
    <div class="auth-overlay" id="auth-overlay">
        <div class="auth-container">
            <span class="close-auth-modal" id="close-auth-modal">&times;</span>
            <div class="auth-header-modal">
                <img src="https://placehold.co/90x90/3498DB/FFFFFF/png?text=TS" alt="Service Logo" style="width: 70px; height: 70px; margin-bottom: 10px;">
                <h1>Welcome to TechSeva</h1>
                <p>Login or create your account to get started.</p>
            </div>

            <div class="auth-tabs">
                <button class="tab-btn active" id="login-tab">Login</button>
                <button class="tab-btn" id="signup-tab">Sign Up</button>
            </div>

            <div class="role-selection">
                <label>I am a:</label>
                <div class="role-options">
                    <button class="role-btn active" data-role="user">
                        <i class="fas fa-user"></i> User
                    </button>
                    <button class="role-btn" data-role="technician">
                        <i class="fas fa-tools"></i> Technician
                    </button>
                    <!-- Admin role button removed from here -->
                </div>
            </div>

            <!-- Login Form -->
            <form id="login-form" class="auth-form active">
                <div class="form-group">
                    <label for="login-email">Email:</label>
                    <input type="email" id="login-email" name="email" placeholder="Enter your email" required>
                </div>
                <div class="form-group password-input">
                    <label for="login-password">Password:</label>
                    <input type="password" id="login-password" name="password" placeholder="Enter your password" required>
                    <i class="fas fa-eye toggle-password"></i>
                </div>
                <input type="hidden" id="login-user-role" name="role" value="user"> <!-- Hidden input for role -->
                <button type="submit" class="auth-btn">Login</button>
                <div class="auth-footer">
                    <p style="margin-bottom: 10px;">OR</p>
                    <!-- Google Sign-in button for Login -->
                    <div id="g_id_signin_wrapper">
                        <div class="g_id_signin"
                             data-type="standard"
                             data-shape="rectangular"
                             data-theme="outline"
                             data-text="signin_with"
                             data-size="large"
                             data-context="signin"> <!-- Removed data-width for better responsiveness -->
                        </div>
                    </div>
                    <a href="javascript:void(0)" class="forgot-password" id="forgot-password-link">Forgot Password?</a>
                </div>
            </form>

            <!-- Sign Up Form -->
            <form id="signup-form" class="auth-form">
                <div class="form-group">
                    <label for="signup-fullname">Full Name:</label>
                    <input type="text" id="signup-fullname" name="fullName" placeholder="Your Full Name" required>
                </div>
                <div class="form-group">
                    <label for="signup-email">Email:</label>
                    <input type="email" id="signup-email" name="email" placeholder="Your Email Address" required>
                </div>
                <div class="form-group">
                    <label for="signup-phone">Phone Number:</label>
                    <input type="tel" id="signup-phone" name="phoneNumber" placeholder="e.g., 9876543210" pattern="[0-9]{10}" required>
                </div>
                <div class="form-group password-input">
                    <label for="signup-password">Password:</label>
                    <input type="password" id="signup-password" name="password" placeholder="Min 8 characters" minlength="8" required>
                    <i class="fas fa-eye toggle-password"></i>
                </div>
                <div class="form-group password-input" id="signup-confirm-password-group">
                    <label for="signup-confirm-password">Confirm Password:</label>
                    <input type="password" id="signup-confirm-password" name="confirmPassword" placeholder="Confirm your password" minlength="8" required>
                    <i class="fas fa-eye toggle-confirm-password"></i>
                </div>

                <!-- Technician Specific Fields (Initially Hidden) -->
                <div id="technician-fields">
                    <div class="form-group">
                        <label for="signup-aadhaar">Aadhaar Number:</label>
                        <input type="text" id="signup-aadhaar" name="aadhaar" placeholder="12-digit Aadhaar" pattern="[0-9]{12}">
                    </div>
                    <div class="form-group">
                        <label for="signup-pan">PAN Number:</label>
                        <input type="text" id="signup-pan" name="pan" placeholder="10-character PAN (e.g., ABCDE1234F)" pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}">
                    </div>
                    <div class="form-group">
                        <label for="signup-skills">Skills (comma-separated):</label>
                        <input type="text" id="signup-skills" name="skills" placeholder="e.g., AC Repair, Electrician">
                    </div>
                </div>

                <input type="hidden" id="signup-user-role" name="role" value="user">
                <button type="submit" class="auth-btn">Sign Up</button>
                <div class="auth-footer">
                    <p id="signup-or-separator" style="margin-bottom: 10px;">OR</p> <!-- Added ID to OR paragraph -->
                    <!-- Google Sign-in button for Register -->
                    <div id="g_id_signup_wrapper">
                        <div class="g_id_signin"
                             data-type="standard"
                             data-shape="rectangular"
                             data-theme="outline"
                             data-text="signup_with"
                             data-size="large"
                             data-context="signup"> <!-- Removed data-width for better responsiveness -->
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- OTP Verification Modal (for Signup) -->
    <div id="otp-modal" class="otp-modal">
        <div class="modal-content">
            <span class="close-otp-modal">&times;</span>
            <h2>Email Verification</h2>
            <p>We've sent a 6-digit OTP to your email <span id="user-email-display"></span></p>
            <div class="otp-input">
                <input type="text" maxlength="1" class="otp-digit" pattern="\d*">
                <input type="text" maxlength="1" class="otp-digit" pattern="\d*">
                <input type="text" maxlength="1" class="otp-digit" pattern="\d*">
                <input type="text" maxlength="1" class="otp-digit" pattern="\d*">
                <input type="text" maxlength="1" class="otp-digit" pattern="\d*">
                <input type="text" maxlength="1" class="otp-digit" pattern="\d*">
            </div>
            <button id="verify-otp" class="auth-btn">Verify</button>
            <p class="resend-otp">Didn't receive OTP? <a href="javascript:void(0)" id="resend-otp">Resend</a></p>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgot-password-modal" class="forgot-password-modal">
        <div class="modal-content">
            <span class="close-forgot-password-modal">&times;</span>
            <h2 id="forgot-password-title">Forgot Password?</h2>
            <p id="forgot-password-message">Enter your email to receive a password reset OTP.</p>

            <!-- Forgot Password Email Input Form -->
            <form id="forgot-password-email-form">
                <div class="form-group">
                    <label for="forgot-password-email">Email:</label>
                    <input type="email" id="forgot-password-email" name="email" placeholder="Enter your registered email" required>
                </div>
                <button type="submit" class="auth-btn" id="send-reset-otp-btn">Send Reset OTP</button>
                <div class="auth-footer" style="margin-top: 15px;">
                    <a href="javascript:void(0)" id="back-to-login-from-forgot-password">Back to Login</a>
                </div>
            </form>

            <!-- Reset Password Form (Hidden by default) -->
            <form id="reset-password-form" style="display: none;">
                <p id="reset-otp-sent-message">We've sent an OTP to <span id="reset-email-display"></span>. Please enter it below.</p>
                <div class="otp-input">
                    <input type="text" maxlength="1" class="otp-digit reset-otp-digit" pattern="\d*">
                    <input type="text" maxlength="1" class="otp-digit reset-otp-digit" pattern="\d*">
                    <input type="text" maxlength="1" class="otp-digit reset-otp-digit" pattern="\d*">
                    <input type="text" maxlength="1" class="otp-digit reset-otp-digit" pattern="\d*">
                    <input type="text" maxlength="1" class="otp-digit reset-otp-digit" pattern="\d*">
                    <input type="text" maxlength="1" class="otp-digit reset-otp-digit" pattern="\d*">
                </div>
                <div class="form-group password-input">
                    <label for="new-password">New Password:</label>
                    <input type="password" id="new-password" name="newPassword" placeholder="Min 8 characters" minlength="8" required>
                    <i class="fas fa-eye toggle-password"></i>
                </div>
                <div class="form-group password-input">
                    <label for="confirm-new-password">Confirm New Password:</label>
                    <input type="password" id="confirm-new-password" name="confirmNewPassword" placeholder="Confirm new password" minlength="8" required>
                    <i class="fas fa-eye toggle-confirm-password"></i>
                </div>
                <button type="submit" class="auth-btn" id="submit-reset-password-btn">Reset Password</button>
                <p class="resend-otp">Didn't receive OTP? <a href="javascript:void(0)" id="resend-reset-otp-btn">Resend</a></p>
            </form>
        </div>
    </div>

    <!-- Phone Update Modal -->
    <div id="phone-update-modal" class="phone-update-modal">
        <div class="modal-content">
            <span class="close-phone-update-modal" id="close-phone-update-modal">&times;</span>
            <h2>Complete Your Profile</h2>
            <p>Please add your phone number to continue.</p>
            <form id="phone-update-form">
                <div class="form-group">
                    <label for="phone-update-input">Phone Number:</label>
                    <input type="tel" id="phone-update-input" name="phoneNumber" placeholder="e.g., 9876543210" pattern="[0-9]{10}" required>
                </div>
                <button type="submit" class="auth-btn" id="phone-update-btn">Update Phone Number</button>
            </form>
        </div>
    </div>

    <!-- Message Box Placeholder -->
    <div id="message-container"></div>

    <!-- Google Identity Services Initialization - Moved to a global location -->
    <!-- This div should be present only once on the page to initialize GSI client -->
    <div id="g_id_onload"
        data-client_id="162423995881-uvq3jdk68i8lsfkk497llfvkp0a45ovm.apps.googleusercontent.com" 
        data-callback="handleCredentialResponse"
        data-nonce="ANY_RANDOM_STRING">
    </div>

    <!-- Load your compiled React bundle FIRST with cache-busting -->
    <script src="/js/react-bundle.js?v=<%= new Date().getTime() %>"></script>

    <!-- Main JavaScript for page functionality (including mounting React) -->
     <script>
        // Function to display messages (success/error)
        const showMessage = (message, type = 'success') => {
            const messageContainer = document.getElementById('message-container');
            if (!messageContainer) return;

            // Remove any existing messages to only show the latest
            messageContainer.innerHTML = ''; 

            const messageBox = document.createElement('div');
            messageBox.className = `message-box ${type}`;
            messageBox.textContent = message;
            messageContainer.appendChild(messageBox);
            messageContainer.style.display = 'block'; 

            setTimeout(() => {
                // Fade out and remove the message box
                messageBox.style.opacity = '0';
                setTimeout(() => {
                    messageBox.remove();
                    // Optionally hide the container again if no messages are left
                    if (!messageContainer.children.length) {
                        messageContainer.style.display = 'none';
                    }
                }, 500); // Wait for fadeOut animation
            }, 4500); // Message visible for 4.5 seconds before fading out
        };

        // Function to check if user is logged in
        async function checkIfLoggedIn() {
            try {
                const response = await fetch('/api/user/me'); // A protected endpoint
                if (response.ok) {
                    const result = await response.json();
                    return result.success && result.user; // True if user data returned, false otherwise
                }
                return false;
            } catch (error) {
                console.warn('Error checking login status:', error);
                return false; // Assume not logged in on network error
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // --- General UI Elements ---
            const menuToggle = document.getElementById('menu-toggle');
            const mainNavMenu = document.getElementById('main-nav-menu');
            const loginNavBtn = document.getElementById('login-nav-btn');
            const joinTechBtn = document.getElementById('join-tech-btn'); // Hero section 'Join as Technician'
            const customerCtaBtn = document.getElementById('customer-cta-btn'); // 'I am a Customer' CTA
            const technicianCtaBtn = document.getElementById('technician-cta-btn'); // 'I am a Technician' CTA
            const adminCtaBtn = document.getElementById('admin-cta-btn'); // 'I am an Admin' CTA
            const getDiagnosisBtn = document.getElementById('get-diagnosis-btn'); // AI Diagnosis button
            const applianceProblemInput = document.getElementById('appliance-problem'); // AI Diagnosis textarea
            const diagnosisResultDiv = document.getElementById('diagnosis-result'); // AI Diagnosis result div
            const loadingIndicator = document.getElementById('loading-indicator'); // AI Diagnosis loading indicator
            const scrollToBookServiceBtn = document.getElementById('scroll-to-book-service'); // New button for scrolling

            // --- Auth Modal Elements ---
            const authOverlay = document.getElementById('auth-overlay');
            const closeAuthModal = document.getElementById('close-auth-modal');
            const loginTab = document.getElementById('login-tab');
            const signupTab = document.getElementById('signup-tab');
            const loginForm = document.getElementById('login-form'); // This is the <form> for login
            const signupForm = document.getElementById('signup-form'); // This is the <form> for signup
            const roleButtons = document.querySelectorAll('.role-btn');
            // const adminLoginRoleBtn = document.getElementById('admin-login-role-btn'); // Admin role button removed from HTML
            const loginRoleInput = document.getElementById('login-user-role'); // Hidden input in login form
            const signupRoleInput = document.getElementById('signup-user-role'); // Hidden input in signup form
            const technicianFields = document.getElementById('technician-fields'); // Technician specific fields div
            const signupConfirmPasswordGroup = document.getElementById('signup-confirm-password-group'); // Confirm password group for signup
            const forgotPasswordLink = document.getElementById('forgot-password-link'); // Added ID to link
            
            // --- OTP Modal Elements (for Signup) ---
            const otpModal = document.getElementById('otp-modal');
            const closeOtpModalBtn = otpModal.querySelector('.close-otp-modal');
            const userEmailDisplay = document.getElementById('user-email-display');
            const otpDigits = otpModal.querySelectorAll('.otp-digit');
            const verifyOtpBtn = document.getElementById('verify-otp');
            const resendOtpBtn = document.getElementById('resend-otp');

            // --- Forgot Password Modal Elements ---
            const forgotPasswordModal = document.getElementById('forgot-password-modal');
            const closeForgotPasswordModalBtn = forgotPasswordModal.querySelector('.close-forgot-password-modal');
            const forgotPasswordEmailForm = document.getElementById('forgot-password-email-form');
            const forgotPasswordEmailInput = document.getElementById('forgot-password-email');
            const sendResetOtpBtn = document.getElementById('send-reset-otp-btn');
            const resetPasswordForm = document.getElementById('reset-password-form');
            const resetEmailDisplay = document.getElementById('reset-email-display');
            const resetOtpDigits = resetPasswordForm.querySelectorAll('.reset-otp-digit'); // Specific class for reset OTP inputs
            const newPasswordInput = document.getElementById('new-password');
            const confirmNewPasswordInput = document.getElementById('confirm-new-password');
            const submitResetPasswordBtn = document.getElementById('submit-reset-password-btn');
            const resendResetOtpBtn = document.getElementById('resend-reset-otp-btn');
            const backToLoginFromForgotPassword = document.getElementById('back-to-login-from-forgot-password');

            // --- Unauthenticated Booking Form Elements (Re-introduced) ---
            const unauthenticatedBookingForm = document.getElementById('unauthenticated-booking-form'); // Corrected ID
            const unauthApplianceType = document.getElementById('unauth-appliance-type');
            // IMPORTANT: This is now the hidden input that React will update
            const unauthLocationHiddenInput = document.getElementById('unauth-location-input'); 
            const unauthScheduledDatetime = document.getElementById('unauth-scheduled-datetime');
            const unauthNotes = document.getElementById('unauth-notes');
            const unauthBookServiceBtn = document.getElementById('unauth-book-service-btn');
            // This is the div where React component will be mounted
            const reactLocationSearchMountPoint = document.getElementById('react-location-search-mount-point');
            // This div is no longer strictly needed for display, as React manages its own input value
            const reactLocationDisplayText = document.getElementById('react-location-display-text');

            // --- Google Signup Button Element and OR Separator for dynamic visibility ---
            const googleSignupWrapper = document.getElementById('g_id_signup_wrapper');
            const signupOrSeparator = document.getElementById('signup-or-separator'); // Get the OR paragraph

            // START: ADD NEW MODAL ELEMENT REFERENCES HERE
            const phoneUpdateModal = document.getElementById('phone-update-modal');
            const closePhoneUpdateModalBtn = document.getElementById('close-phone-update-modal');
            const phoneUpdateForm = document.getElementById('phone-update-form');
            const phoneUpdateInput = document.getElementById('phone-update-input');
            const phoneUpdateBtn = document.getElementById('phone-update-btn');
            // END: ADD NEW MODAL ELEMENT REFERENCES


            // --- Navbar Hamburger Menu Toggle ---
            menuToggle.addEventListener('click', () => {
                mainNavMenu.classList.toggle('active');
            });

            // --- Show Auth Modal Function ---
            const showAuthModal = (initialTab = 'login', initialRole = 'user') => {
                authOverlay.style.display = 'flex'; // Show the modal overlay
                forgotPasswordModal.style.display = 'none'; // Ensure forgot password modal is hidden
                phoneUpdateModal.style.display = 'none'; // Ensure new phone modal is hidden

                // Set initial tab and update Google button context
                if (initialTab === 'signup') {
                    signupTab.click(); // Programmatically click signup tab
                } else {
                    loginTab.click(); // Programmatically click login tab
                }

                // Set initial role (simulate click on role button)
                roleButtons.forEach(button => {
                    if (button.dataset.role === initialRole) {
                        button.click();
                    }
                });
            };

            // --- Event Listeners to Redirect to Auth Pages ---
            loginNavBtn.addEventListener('click', () => window.location.href = '/login');
            joinTechBtn.addEventListener('click', () => window.location.href = '/signup');
            customerCtaBtn.addEventListener('click', (e) => { e.preventDefault(); window.location.href = '/login'; });
            technicianCtaBtn.addEventListener('click', (e) => { e.preventDefault(); window.location.href = '/signup'; });
            
            // --- Admin CTA Button now directly redirects ---
            adminCtaBtn.addEventListener('click', (e) => {
                e.preventDefault(); // Prevent default anchor behavior
                window.location.href = 'https://tech-seva.onrender.com/admin-login';
            });

            // --- Close Auth Modal ---
            closeAuthModal.addEventListener('click', () => {
                authOverlay.style.display = 'none';
                showMessage('', null); // Clear any general messages
            });

            // Close auth modal if clicked outside
            authOverlay.addEventListener('click', (e) => {
                if (e.target === authOverlay) {
                    authOverlay.style.display = 'none';
                    showMessage('', null); // Clear any general messages
                }
            });

            // --- Tab Switching Logic (Login/Signup) ---
            loginTab.addEventListener('click', () => {
                loginTab.classList.add('active');
                signupTab.classList.remove('active');
                loginForm.classList.add('active');
                signupForm.classList.remove('active');

                showMessage('', null); // Clear general message box

                // Ensure technician fields are hidden for login tab
                technicianFields.style.display = 'none';
                // Remove required attributes from technician fields when hidden
                technicianFields.querySelectorAll('input').forEach(input => input.removeAttribute('required'));

                // For login, default to user role. All roles (user, technician) are visible now.
                document.querySelector('.role-btn[data-role="user"]').click(); 

                // Re-render Google button for login context
                google.accounts.id.renderButton(
                    document.querySelector('#login-form .g_id_signin'),
                    {
                        type: "standard",
                        shape: "rectangular",
                        theme: "outline",
                        text: "signin_with",
                        size: "large",
                        context: "signin"
                    }
                );
            });

            signupTab.addEventListener('click', () => {
                signupTab.classList.add('active');
                loginTab.classList.remove('active');
                signupForm.classList.add('active');
                loginForm.classList.remove('active');

                showMessage('', null); // Clear general message box

                // Default to user on signup tab switch; this will make Google button visible
                document.querySelector('.role-btn[data-role="user"]').click();

                // Re-render Google button for signup context (initially visible)
                if (googleSignupWrapper) {
                    googleSignupWrapper.style.display = 'flex'; // Ensure it's visible by default for signup form
                    // Call renderButton here only if you need to re-initialize it for some reason,
                    // otherwise, the onload initialization usually handles it.
                    // This re-rendering will ensure the size attributes are picked up again.
                     google.accounts.id.renderButton(
                        document.querySelector('#signup-form .g_id_signin'), // Targeting the signup button
                        {
                            type: "standard",
                            shape: "rectangular",
                            theme: "outline",
                            text: "signup_with",
                            size: "large",
                            context: "signup"
                        }
                    );
                }
                if (signupOrSeparator) {
                    signupOrSeparator.style.display = 'block'; // Ensure OR is visible by default for signup form
                }
            });

            // --- Role Selection Logic (User, Technician) ---
            roleButtons.forEach(button => {
                button.addEventListener('click', () => {
                    roleButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    const selectedRole = button.dataset.role;

                    // Update hidden role inputs for both forms, depending on which form is active
                    if (loginForm.classList.contains('active')) {
                        loginRoleInput.value = selectedRole;
                    } else if (signupForm.classList.contains('active')) {
                        signupRoleInput.value = selectedRole;
                        // Toggle technician-specific fields visibility based on role for signup form
                        if (selectedRole === 'technician') {
                            technicianFields.style.display = 'block';
                            // Make technician fields required for signup
                            document.getElementById('signup-aadhaar').setAttribute('required', 'required');
                            document.getElementById('signup-pan').setAttribute('required', 'required');
                            document.getElementById('signup-skills').setAttribute('required', 'required');
                            
                            // Hide Google Signup button and OR for technicians
                            if (googleSignupWrapper) {
                                googleSignupWrapper.style.display = 'none';
                            }
                            if (signupOrSeparator) {
                                signupOrSeparator.style.display = 'none';
                            }
                        } else { // User role selected
                            technicianFields.style.display = 'none';
                            // Remove required attribute if not technician
                            document.getElementById('signup-aadhaar').removeAttribute('required');
                            document.getElementById('signup-pan').removeAttribute('required');
                            document.getElementById('signup-skills').removeAttribute('required');

                            // Show Google Signup button and OR for users
                            if (googleSignupWrapper) {
                                googleSignupWrapper.style.display = 'flex';
                                // Re-render the Google button to ensure correct sizing is applied when it becomes visible
                                google.accounts.id.renderButton(
                                    document.querySelector('#signup-form .g_id_signin'),
                                    {
                                        type: "standard",
                                        shape: "rectangular",
                                        theme: "outline",
                                        text: "signup_with",
                                        size: "large",
                                        context: "signup"
                                    }
                                );
                            }
                            if (signupOrSeparator) {
                                signupOrSeparator.style.display = 'block';
                            }
                        }
                    }
                });
            });

            // Set initial active role button and hidden input value on page load
            // This needs to be done AFTER the tab listeners are set up for proper behavior
            document.querySelector('.role-btn[data-role="user"]').click();


            // --- Password Toggle Logic ---
            document.querySelectorAll('.toggle-password, .toggle-confirm-password').forEach(toggle => {
                toggle.addEventListener('click', () => {
                    const passwordInput = toggle.previousElementSibling;
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);
                    toggle.classList.toggle('fa-eye');
                    toggle.classList.toggle('fa-eye-slash');
                });
            });

            // --- Login Form Submission ---
            const loginEmailInput = document.getElementById('login-email');
            const loginPasswordInput = document.getElementById('login-password');
            const loginSubmitBtn = loginForm.querySelector('.auth-btn');

            loginForm.addEventListener('submit', async (event) => {
                event.preventDefault(); // Prevent default form submission
                showMessage('', null); // Clear previous messages

                const email = loginEmailInput.value.trim();
                const password = loginPasswordInput.value;
                const role = loginRoleInput.value; // This is the role from the hidden input

                // --- IMPORTANT DEBUGGING LOG ---
                console.log('Sending login data to server:', { email, password, role });
                // --- END DEBUGGING LOG ---

                if (!email || !password || !role) {
                    showMessage('Please enter email, password, and select a role.', 'error');
                    return;
                }

                loginSubmitBtn.disabled = true;
                loginSubmitBtn.textContent = 'Logging in...';

                try {
                    const response = await fetch('/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password, role })
                    });
                    const result = await response.json();

                    if (response.ok) { // Check for successful HTTP status (2xx)
                        showMessage(result.message, 'success');
                        // If login is successful, check if there's pending booking data
                        const prefillData = sessionStorage.getItem('prefillBookingData');
                        if (prefillData) {
                            // User was trying to book, now logged in, redirect to user dashboard
                            sessionStorage.removeItem('prefillBookingData'); // Clear it as it will be handled on the next page
                            setTimeout(() => {
                                window.location.href = '/user'; // Assuming /user will process this
                            }, 500);
                        } else if (result.redirect) {
                            // Regular login redirect
                            setTimeout(() => {
                                window.location.href = result.redirect;
                            }, 500);
                        } else {
                            console.warn('Login successful but no redirect URL provided by server. Closing modal.');
                            showMessage('Login successful! Welcome.', 'success');
                            authOverlay.style.display = 'none'; // Close the main auth modal
                        }
                    } else {
                        // Handle non-2xx responses (e.g., 401 Unauthorized)
                        showMessage(result.message || 'Login failed. Please check your credentials.', 'error');
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    showMessage('Network error during login. Please try again.', 'error');
                } finally {
                    loginSubmitBtn.disabled = false;
                    loginSubmitBtn.textContent = 'Login';
                }
            });

            // --- Google Sign-in Callback (handled by Google Identity Services) ---
            window.handleCredentialResponse = async (response) => {
                console.log('Google Sign-In response received:', response);
                // 'response.credential' contains the ID token
                const idToken = response.credential;
                showMessage('Signing in with Google...', 'info');

                if (!idToken) {
                    console.error('Google Sign-In: ID token not found in response.', response);
                    showMessage('Google Sign-in failed: No ID token received.', 'error');
                    return;
                }
                console.log('Google Sign-In: ID Token:', idToken.substring(0, 30) + '...'); // Log part of the token

                try {
                    const res = await fetch('/api/google-login', { // New endpoint for Google login
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ idToken })
                    });
                    
                    // Here's the key change: we check the response.ok status to catch network errors
                    if (!res.ok) {
                        const errorData = await res.json();
                        throw new Error(errorData.message || `Server responded with status ${res.status}`);
                    }

                    const data = await res.json();
                    console.log('Response data from /api/google-login:', data);

                    if (data.success) { // Check for the new 'needsPhoneUpdate' flag
                        if (data.needsPhoneUpdate) {
                            showMessage(data.message || "Please add your phone number to continue.", 'info');
                            document.getElementById('auth-overlay').style.display = 'none'; // Hide the main auth modal
                            phoneUpdateModal.style.display = 'flex'; // Show the new phone update modal
                        } else { // Successful login without redirect (e.g., if already on home page)
                            showMessage(data.message || "Google Sign-In successful!", 'success');
                            document.getElementById('auth-overlay').style.display = 'none';
                            if (data.redirect) {
                                 setTimeout(() => {
                                    window.location.href = data.redirect;
                                }, 500);
                            }
                        }
                    } else { // Failed login
                        showMessage(data.message || "Google Sign-in failed.", 'error');
                    }
                } catch (error) {
                    console.error('Error during Google sign-in (frontend fetch to backend):', error);
                    showMessage(error.message || 'Network error during Google Sign-In. Please try again.', 'error');
                }
            };


            // --- Signup Form Submission (Initiates OTP Send) ---
            const signupFullNameInput = document.getElementById('signup-fullname');
            const signupEmailInput = document.getElementById('signup-email');
            const signupPhoneInput = document.getElementById('signup-phone');
            const signupPasswordInput = document.getElementById('signup-password');
            const signupConfirmPasswordInput = document.getElementById('signup-confirm-password');
            const signupAadhaarInput = document.getElementById('signup-aadhaar');
            const signupPanInput = document.getElementById('signup-pan');
            const signupSkillsInput = document.getElementById('signup-skills');
            const signupSubmitBtn = signupForm.querySelector('.auth-btn');

            signupForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                showMessage('', null); // Clear previous messages

                const fullName = signupFullNameInput.value.trim();
                const email = signupEmailInput.value.trim();
                const phoneNumber = signupPhoneInput.value.trim();
                const password = signupPasswordInput.value;
                const confirmPassword = signupConfirmPasswordInput.value;
                const role = signupRoleInput.value; // Get the currently selected role for signup

                // --- Frontend Validation ---
                if (!fullName || !email || !phoneNumber || !password || !confirmPassword) {
                    showMessage('Please fill in all required fields.', 'error');
                    return;
                }
                if (password !== confirmPassword) {
                    showMessage('Passwords do not match.', 'error');
                    return;
                }
                if (password.length < 8) {
                    showMessage('Password must be at least 8 characters.', 'error');
                    return;
                }
                if (!email.includes('@') || !email.includes('.')) {
                    showMessage('Please enter a valid email address.', 'error');
                    return;
                }
                if (!phoneNumber || !/^\d{10}$/.test(phoneNumber)) {
                    showMessage('Please enter a valid 10-digit phone number.', 'error');
                    return;
                }
                // End Frontend Validation

                const signupData = { fullName, email, phoneNumber, password, role };
                if (role === 'technician') {
                    signupData.aadhaar = signupAadhaarInput.value.trim();
                    signupData.pan = signupPanInput.value.trim();
                    signupData.skills = signupSkillsInput.value.trim();

                    if (!signupData.aadhaar || !signupData.pan || !signupData.skills) {
                        showMessage('Technician registration requires Aadhaar, PAN, and Skills.', 'error');
                        return;
                    }
                }

                signupSubmitBtn.disabled = true;
                signupSubmitBtn.textContent = 'Sending OTP...';

                try {
                    const otpResponse = await fetch('/send-otp', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email: signupData.email })
                    });
                    const otpResult = await otpResponse.json();

                    if (otpResponse.ok) { // Check for successful HTTP status (2xx)
                        userEmailDisplay.textContent = signupData.email;
                        otpModal.style.display = 'flex';
                        showMessage(otpResult.message, 'success');
                        sessionStorage.setItem('pendingSignupData', JSON.stringify(signupData));
                    } else {
                        showMessage(otpResult.message || 'Failed to send OTP.', 'error');
                    }
                } catch (error) {
                    console.error('Signup (OTP Send) error:', error);
                    showMessage('Network error during OTP send. Please try again.', 'error');
                } finally {
                    signupSubmitBtn.disabled = false;
                    signupSubmitBtn.textContent = 'Sign Up';
                }
            });

            // --- OTP Input focus management (for Signup OTP) ---
            otpDigits.forEach((digitInput, index) => {
                digitInput.addEventListener('input', () => {
                    if (digitInput.value.length === 1 && index < otpDigits.length - 1) {
                        otpDigits[index + 1].focus();
                    }
                    const allFilled = Array.from(otpDigits).every(input => input.value.length === 1);
                    if (allFilled) {
                        verifyOtpBtn.click();
                    }
                });

                digitInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && digitInput.value === '' && index > 0) {
                        otpDigits[index - 1].focus();
                    }
                });
            });

            // --- Close OTP Modal (for Signup OTP) ---
            closeOtpModalBtn.addEventListener('click', () => {
                otpModal.style.display = 'none';
                sessionStorage.removeItem('pendingSignupData');
                showMessage('', null);
                otpDigits.forEach(digit => digit.value = '');
            });

            // --- Verify OTP and Complete Registration (for Signup OTP) ---
            verifyOtpBtn.addEventListener('click', async () => {
                showMessage('', null);

                const enteredOtp = Array.from(otpDigits).map(input => input.value).join('');
                const storedSignupData = JSON.parse(sessionStorage.getItem('pendingSignupData'));

                if (!storedSignupData || !storedSignupData.email) {
                    showMessage('No pending signup data found. Please restart registration.', 'error');
                    otpModal.style.display = 'none';
                    return;
                }
                if (enteredOtp.length !== 6) {
                    showMessage('Please enter a complete 6-digit OTP.', 'error');
                    return;
                }

                verifyOtpBtn.disabled = true;
                verifyOtpBtn.textContent = 'Verifying...';
                resendOtpBtn.disabled = true;

                try {
                    const verifyResponse = await fetch('/verify-otp', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email: storedSignupData.email, otp: enteredOtp })
                    });
                    const verifyResult = await verifyResponse.json();

                    if (!verifyResponse.ok) { // Check for successful HTTP status (2xx) for OTP verification
                        throw new Error(verifyResult.message || 'OTP verification failed.');
                    }

                    const registerResponse = await fetch('/register', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(storedSignupData)
                    });
                    const registerResult = await registerResponse.json();

                    if (!registerResponse.ok) { // Check for successful HTTP status (2xx) for registration
                        throw new Error(registerResult.message || 'Registration failed after OTP verification.');
                    }

                    otpModal.style.display = 'none';
                    showMessage('Registration successful! You can now login.', 'success');
                    // Check for prefill data after successful signup
                    const prefillData = sessionStorage.getItem('prefillBookingData');
                    if (prefillData) {
                        sessionStorage.removeItem('prefillBookingData'); // Clear it as it will be handled on the next page
                        window.location.href = '/user'; // Redirect to user dashboard
                    } else if (registerResult.redirect) {
                        window.location.href = registerResult.redirect;
                    } else {
                        // Fallback if no specific redirect and no prefill
                        authOverlay.style.display = 'none'; // Close the main auth modal
                    }


                } catch (error) {
                    console.error('OTP Verification or Registration Error:', error);
                    showMessage(error.message || 'An error occurred during verification or registration.', 'error');
                    otpModal.style.display = 'none';
                    sessionStorage.removeItem('pendingSignupData');
                } finally {
                    verifyOtpBtn.disabled = false;
                    verifyOtpBtn.textContent = 'Verify';
                    resendOtpBtn.disabled = false;
                }
            });

            // --- Resend OTP (for Signup OTP) ---
            resendOtpBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                showMessage('', null);

                const storedSignupData = JSON.parse(sessionStorage.getItem('pendingSignupData'));

                if (!storedSignupData || !storedSignupData.email) {
                    showMessage('No email found to resend OTP. Please restart registration.', 'error');
                    return;
                }

                resendOtpBtn.disabled = true;
                resendOtpBtn.textContent = 'Sending...';

                try {
                    const response = await fetch('/send-otp', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email: storedSignupData.email })
                    });
                    const result = await response.json();
                    if (response.ok) { // Check for successful HTTP status (2xx)
                        showMessage(result.message, 'success');
                    } else {
                        showMessage(result.message || 'Failed to resend OTP.', 'error');
                    }
                } catch (error) {
                    console.error('Resend OTP error:', error);
                    showMessage('Network error while resending OTP.', 'error');
                } finally {
                    resendOtpBtn.disabled = false;
                    resendOtpBtn.textContent = 'Resend';
                }
            });

            // --- Forgot Password Link Click ---
            forgotPasswordLink.addEventListener('click', (e) => {
                e.preventDefault();
                authOverlay.style.display = 'none'; // Hide main auth modal
                forgotPasswordModal.style.display = 'flex'; // Show forgot password modal
                // Reset its state
                forgotPasswordEmailForm.style.display = 'block';
                resetPasswordForm.style.display = 'none';
                forgotPasswordEmailInput.value = '';
                resetOtpDigits.forEach(input => input.value = '');
                newPasswordInput.value = '';
                confirmNewPasswordInput.value = '';
                showMessage('', null); // Clear any messages
            });

            // --- Close Forgot Password Modal ---
            closeForgotPasswordModalBtn.addEventListener('click', () => {
                forgotPasswordModal.style.display = 'none';
                sessionStorage.removeItem('pendingResetEmail'); // Clear stored email for reset
                showMessage('', null);
            });

            // --- Send Reset OTP Form Submission ---
           // index.html
// ...
            // --- Send Reset OTP Form Submission ---
            forgotPasswordEmailForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                showMessage('', null);
                const email = forgotPasswordEmailInput.value.trim();
                if (!email) {
                    showMessage('Please enter your email address.', 'error');
                    return;
                }

                sendResetOtpBtn.disabled = true;
                sendResetOtpBtn.textContent = 'Sending OTP...';

                try {
                    // Updated endpoint to '/send-otp' with type 'password_reset'
                    const response = await fetch('/send-otp', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, type: 'password_reset' }) // Pass type to the endpoint
                    });
                    const result = await response.json();

                    if (response.ok) { // Check for successful HTTP status (2xx)
                        sessionStorage.setItem('pendingResetEmail', email); // Store email for reset process
                        resetEmailDisplay.textContent = email;
                        forgotPasswordEmailForm.style.display = 'none'; // Hide email form
                        resetPasswordForm.style.display = 'block'; // Show reset password form
                        showMessage(result.message, 'success');
                        resetOtpDigits.forEach(input => input.value = ''); // Clear OTP inputs
                        resetOtpDigits[0].focus(); // Focus on first OTP digit
                    } else {
                        showMessage(result.message || 'Failed to send reset OTP.', 'error');
                    }
                } catch (error) {
                    console.error('Send Reset OTP Error:', error);
                    showMessage('Network error while sending reset OTP. Please try again.', 'error');
                } finally {
                    sendResetOtpBtn.disabled = false;
                    sendResetOtpBtn.textContent = 'Send Reset OTP';
                }
            });
// ...
            // --- OTP Input focus management (for Reset OTP) ---
            resetOtpDigits.forEach((digitInput, index) => {
                digitInput.addEventListener('input', () => {
                    if (digitInput.value.length === 1 && index < resetOtpDigits.length - 1) {
                        resetOtpDigits[index + 1].focus();
                    }
                    // Do not auto-submit here, let user click 'Reset Password' after entering new password
                });

                digitInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && digitInput.value === '' && index > 0) {
                        otpDigits[index - 1].focus();
                    }
                });
            });

            // --- Resend Reset OTP ---
            resendResetOtpBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                showMessage('', null);

                const email = sessionStorage.getItem('pendingResetEmail');
                if (!email) {
                    showMessage('No email found to resend OTP. Please restart forgot password process.', 'error');
                    return;
                }

                resendResetOtpBtn.disabled = true;
                resendResetOtpBtn.textContent = 'Sending...';

                try {
                    const response = await fetch('/send-otp', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, type: 'password_reset' }) // Use correct endpoint and type
                    });
                    const result = await response.json();
                    if (response.ok) { // Check for successful HTTP status (2xx)
                        showMessage(result.message, 'success');
                    } else {
                        showMessage(result.message || 'Failed to resend OTP.', 'error');
                    }
                } catch (error) {
                    console.error('Resend Reset OTP error:', error);
                    showMessage('Network error while resending OTP.', 'error');
                } finally {
                    resendResetOtpBtn.disabled = false;
                    resendResetOtpBtn.textContent = 'Resend';
                }
            });


            // --- Submit Reset Password Form ---
            resetPasswordForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                showMessage('', null);

                const email = sessionStorage.getItem('pendingResetEmail');
                const enteredOtp = Array.from(resetOtpDigits).map(input => input.value).join('');
                const newPassword = newPasswordInput.value;
                const confirmNewPassword = confirmNewPasswordInput.value;

                if (!email || !enteredOtp || !newPassword || !confirmNewPassword) {
                    showMessage('All fields are required.', 'error');
                    return;
                }
                if (newPassword !== confirmNewPassword) {
                    showMessage('New passwords do not match.', 'error');
                    return;
                }
                if (newPassword.length < 8) {
                    showMessage('New password must be at least 8 characters.', 'error');
                    return;
                }
                if (enteredOtp.length !== 6) {
                    showMessage('Please enter the complete 6-digit OTP.', 'error');
                    return;
                }

                submitResetPasswordBtn.disabled = true;
                submitResetPasswordBtn.textContent = 'Resetting...';

                try {
                    const response = await fetch('/reset-password', { // New endpoint for password reset
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, otp: enteredOtp, newPassword })
                    });
                    const result = await response.json();

                    if (response.ok) { // Check for successful HTTP status (2xx)
                        showMessage(result.message, 'success');
                        forgotPasswordModal.style.display = 'none'; // Close reset modal
                        authOverlay.style.display = 'flex'; // Show main login modal
                        loginTab.click(); // Switch to login tab
                        // Clear forms and session storage
                        forgotPasswordEmailForm.reset();
                        resetPasswordForm.reset();
                        resetOtpDigits.forEach(input => input.value = '');
                        sessionStorage.removeItem('pendingResetEmail');
                    } else {
                        showMessage(result.message || 'Failed to reset password.', 'error');
                    }
                } catch (error) {
                    console.error('Reset Password Error:', error);
                    showMessage('Network error during password reset. Please try again.', 'error');
                } finally {
                    submitResetPasswordBtn.disabled = false;
                    submitResetPasswordBtn.textContent = 'Reset Password';
                }
            });

            // --- Back to Login from Forgot Password ---
            backToLoginFromForgotPassword.addEventListener('click', (e) => {
                e.preventDefault();
                forgotPasswordModal.style.display = 'none';
                authOverlay.style.display = 'flex';
                loginTab.click(); // Ensure login tab is active
                showMessage('', null);
            });

            // --- Phone Update Modal Event Listeners ---
            // Close Phone Update Modal
            closePhoneUpdateModalBtn.addEventListener('click', () => {
                phoneUpdateModal.style.display = 'none';
                showMessage('', null);
            });

            // Phone Update Form Submission
            phoneUpdateForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                showMessage('', null);

                const phoneNumber = phoneUpdateInput.value.trim();

                if (!phoneNumber || !/^\d{10}$/.test(phoneNumber)) {
                    showMessage('Please enter a valid 10-digit phone number.', 'error');
                    return;
                }

                phoneUpdateBtn.disabled = true;
                phoneUpdateBtn.textContent = 'Updating...';

                try {
                    const response = await fetch('/api/user/update-phone', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ phoneNumber })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        showMessage(data.message || 'Phone number updated successfully!', 'success');
                        phoneUpdateModal.style.display = 'none';
                        if (data.redirect) {
                            setTimeout(() => {
                                window.location.href = data.redirect;
                            }, 500);
                        }
                    } else {
                        showMessage(data.message || 'Failed to update phone number.', 'error');
                    }
                } catch (error) {
                    console.error('Phone update error:', error);
                    showMessage('Network error during phone update. Please try again.', 'error');
                } finally {
                    phoneUpdateBtn.disabled = false;
                    phoneUpdateBtn.textContent = 'Update Phone Number';
                }
            });


            // --- AI Diagnosis Logic ---
            if (getDiagnosisBtn && applianceProblemInput && diagnosisResultDiv && loadingIndicator) {
                getDiagnosisBtn.addEventListener('click', async () => {
                    const problemDescription = applianceProblemInput.value.trim();
                    diagnosisResultDiv.style.display = 'none';
                    diagnosisResultDiv.textContent = '';
                    loadingIndicator.style.display = 'none';
                    showMessage('', null);

                    if (!problemDescription) {
                        showMessage('Please describe the problem with your appliance.', 'error');
                        return;
                    }

                    loadingIndicator.style.display = 'block';
                    getDiagnosisBtn.disabled = true;
                    getDiagnosisBtn.textContent = 'Diagnosing...';

                    try {
                        // Corrected API URL: Call your backend endpoint instead of the external Gemini API
                        const apiUrl = '/api/ai-diagnosis'; // This now points to your server.js endpoint

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ problemDescription: problemDescription }) // Send problemDescription to your backend
                        });

                        const result = await response.json();
                        if (response.ok && result.diagnosis) { // Check for successful HTTP status (2xx) and 'diagnosis' property from your backend
                            diagnosisResultDiv.textContent = result.diagnosis;
                            diagnosisResultDiv.style.display = 'block';
                            showMessage('Diagnosis complete!', 'success');
                        } else {
                            diagnosisResultDiv.textContent = result.message || 'Could not get a diagnosis. Please try again or rephrase.';
                            diagnosisResultDiv.style.display = 'block';
                            showMessage(result.message || 'Failed to get AI diagnosis.', 'error');
                        }
                    } catch (error) {
                        console.error('AI Diagnosis API error:', error);
                        diagnosisResultDiv.textContent = 'An error occurred during diagnosis. Please try again later.';
                        diagnosisResultDiv.style.display = 'block';
                        showMessage('Error connecting to AI diagnosis service.', 'error');
                    } finally {
                        loadingIndicator.style.display = 'none';
                        getDiagnosisBtn.disabled = false;
                        getDiagnosisBtn.textContent = 'Get AI Diagnosis âœ¨';
                    }
                });
            }

            // --- Unauthenticated Booking Form Submission Logic ---
           // --- Unauthenticated Booking Form Submission Logic ---
if (unauthenticatedBookingForm) {
    unauthenticatedBookingForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        showMessage('', null);

        const applianceType = unauthApplianceType.value;

        if (!applianceType) {
            showMessage('Please select an appliance type.', 'error');
            return;
        }

        // Simulating the booking process without backend calls for this flow
        unauthBookServiceBtn.disabled = true;
        unauthBookServiceBtn.textContent = 'Processing...';

        // Check if the user is logged in (simulated check)
        const isLoggedIn = await checkIfLoggedIn();

        if (isLoggedIn) {
            // This is the ideal case where the user is already logged in.
            // In a real app, you would process the booking. For this example, we show a success message.
            showMessage('Service booked successfully! Redirecting...', 'success');
            setTimeout(() => {
                // In a real application, you would redirect to a confirmation page.
                console.log("User is logged in, but not redirected due to code changes.");
                unauthBookServiceBtn.disabled = false;
                unauthBookServiceBtn.textContent = 'Book Service';
            }, 2000);
        } else {
            // User is not logged in, so redirect to login page.
            showMessage('Please log in or sign up to complete your service booking.', 'info');
            window.location.href = '/login'; // Redirect to login page.
            unauthBookServiceBtn.disabled = false;
            unauthBookServiceBtn.textContent = 'Book Service';
        }
    });
}


            // --- Fare Prediction Form Submission ---
            const farePredictionForm = document.getElementById('fare-prediction-form');
            const predictFareBtn = document.getElementById('predict-fare-btn');
            const fareResultDiv = document.getElementById('fare-result');
            const fareLoadingIndicator = document.getElementById('fare-loading-indicator');

            if (farePredictionForm) {
                farePredictionForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    showMessage('', null);

                    const technicianLat = technicianLatInput.value;
                    const technicianLon = technicianLonInput.value;
                    const userLat = userLatInput.value;
                    const userLon = userLonInput.value;
                    const datetime = document.getElementById('visit-datetime').value;

                    if (!technicianLat || !technicianLon || !userLat || !userLon || !datetime) {
                        showMessage('Please select both locations and enter a date/time.', 'error');
                        return;
                    }

                    fareResultDiv.style.display = 'none';
                    fareResultDiv.textContent = '';
                    fareLoadingIndicator.style.display = 'block';
                    predictFareBtn.disabled = true;
                    predictFareBtn.textContent = 'Predicting...';

                    try {
                        const response = await fetch('/api/predict-fare', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                pickup_lat: parseFloat(technicianLat),
                                pickup_lon: parseFloat(technicianLon),
                                dropoff_lat: parseFloat(userLat),
                                dropoff_lon: parseFloat(userLon),
                                datetime: datetime
                            })
                        });

                        const result = await response.json();
                        if (response.ok && result.fare) {
                            fareResultDiv.textContent = `Estimated Travel Fee: â‚¹${result.fare.toFixed(2)}`;
                            fareResultDiv.style.display = 'block';
                            showMessage('Fare prediction complete!', 'success');
                        } else {
                            fareResultDiv.textContent = result.message || 'Could not predict fare. Please try again.';
                            fareResultDiv.style.display = 'block';
                            showMessage(result.message || 'Failed to predict fare.', 'error');
                        }
                    } catch (error) {
                        console.error('Fare prediction error:', error);
                        fareResultDiv.textContent = 'An error occurred during fare prediction. Please try again later.';
                        fareResultDiv.style.display = 'block';
                        showMessage('Error connecting to fare prediction service.', 'error');
                    } finally {
                        fareLoadingIndicator.style.display = 'none';
                        predictFareBtn.disabled = false;
                        predictFareBtn.textContent = 'Predict Travel Fee';
                    }
                });
            }

            // --- Scroll to Book Service button logic ---
            if (scrollToBookServiceBtn) {
                scrollToBookServiceBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const bookingSection = document.getElementById('unauthenticated-book-service');
                    if (bookingSection) {
                        bookingSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                });
            }

            // --- Initial state: allow browsing without login ---
            // This logic handles prefill data for logged-in users but allows unauthenticated users to browse freely
            checkIfLoggedIn().then(isLoggedIn => {
                console.log('[DEBUG] checkIfLoggedIn result:', isLoggedIn);
                const prefillData = sessionStorage.getItem('prefillBookingData');
                console.log('[DEBUG] prefillData:', prefillData);
                if (prefillData && isLoggedIn) {
                    console.log('[DEBUG] Redirecting to /user due to prefillData and logged in');
                    sessionStorage.removeItem('prefillBookingData');
                    window.location.href = '/user';
                } else {
                    console.log('[DEBUG] Allowing user to browse home page freely');
                    // No automatic redirect for unauthenticated users - they can browse services
                }
            });

            // --- Important: Render the React Location Search component after the DOM is ready ---
            // This needs to be INSIDE the DOMContentLoaded listener to ensure mountPoint exists.
            const mountPoint = document.getElementById('react-location-search-mount-point');
            const locationHiddenInput = document.getElementById('unauth-location-input');
            const locationDisplayText = document.getElementById('react-location-display-text'); // This is now hidden

            // Define the callback function to receive data from the React component
            const handleLocationSelection = ({ formattedAddress, placeId, latitude, longitude }) => {
                // Update the hidden form input with the selected address
                locationHiddenInput.value = formattedAddress;
                // We no longer need to update locationDisplayText as it's hidden
                console.log('Location selected by React:', formattedAddress, 'Place ID:', placeId);
            };

            // Call the exported function from your bundled React code
            // Check if window.renderLocationSearchInput exists before calling
            if (window.renderLocationSearchInput && mountPoint) {
                // Check if pre-filled location exists in session storage (e.g., from a previous attempt)
                const prefillData = sessionStorage.getItem('prefillBookingData');
                let initialLocation = '';
                if (prefillData) {
                    try {
                        const parsedPrefill = JSON.parse(prefillData);
                        if (parsedPrefill.location) {
                            initialLocation = parsedPrefill.location;
                        }
                    } catch (e) {
                        console.error('Error parsing prefillBookingData from session storage:', e);
                    }
                }

                window.renderLocationSearchInput(mountPoint, handleLocationSelection, initialLocation);
                // Also update the hidden input with initial location if provided
                if (initialLocation) {
                    locationHiddenInput.value = initialLocation;
                }
            } else {
                console.error('window.renderLocationSearchInput or mount point not defined. React component cannot render.');
                // Fallback for user experience if React component fails to load
                if (mountPoint) {
                    // Create a simple text input as a fallback if React fails to load
                    mountPoint.innerHTML = '<input type="text" id="unauth-location-input-fallback" class="w-full p-2 border rounded" placeholder="Location search unavailable. Please enter manually." />';
                    const fallbackInput = document.getElementById('unauth-location-input-fallback');
                    fallbackInput.addEventListener('input', (e) => {
                        // Update the hidden input when the fallback input changes
                        locationHiddenInput.value = e.target.value;
                    });
                     // Copy initial location to fallback input if it exists
                    if (initialLocation) {
                        fallbackInput.value = initialLocation;
                        locationHiddenInput.value = initialLocation;
                    }
                }
            }

            // --- Fare Prediction Location Components ---
            const technicianMountPoint = document.getElementById('technician-location-mount-point');
            const technicianLatInput = document.getElementById('technician-lat');
            const technicianLonInput = document.getElementById('technician-lon');

            const handleTechnicianLocationSelection = ({ formattedAddress, placeId, latitude, longitude }) => {
                technicianLatInput.value = latitude;
                technicianLonInput.value = longitude;
                console.log('Technician location selected:', formattedAddress, latitude, longitude);
            };

            const userMountPoint = document.getElementById('user-location-mount-point');
            const userLatInput = document.getElementById('user-lat');
            const userLonInput = document.getElementById('user-lon');

            const handleUserLocationSelection = ({ formattedAddress, placeId, latitude, longitude }) => {
                userLatInput.value = latitude;
                userLonInput.value = longitude;
                console.log('User location selected:', formattedAddress, latitude, longitude);
            };

            if (window.renderLocationSearchInput) {
                if (technicianMountPoint) {
                    window.renderLocationSearchInput(technicianMountPoint, handleTechnicianLocationSelection, '');
                }
                if (userMountPoint) {
                    window.renderLocationSearchInput(userMountPoint, handleUserLocationSelection, '');
                }
            } else {
                console.error('window.renderLocationSearchInput not defined. Fare prediction location components cannot render.');
            }
        });
           
        // Dummy initMap function definition, required by Google Maps API script tag's 'callback' parameter
        function initMap() {
            // This function is intentionally left empty as we are using Geocoding API via backend.
            // However, the Google Maps script URL requires it.
            console.log("initMap called (dummy function for Google Maps API loading).");
        }

        // --- Google Sign-in Callback (provided by Google Identity Services) ---
        // This function is called by the GSI library after a user signs in.
        function handleCredentialResponse(response) {
            console.log("Google Token Received:", response.credential);

            // Send the ID token to your backend for verification and session management
            fetch("/api/google-login", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ idToken: response.credential }) // Use 'idToken' as expected by backend
            })
            .then(async res => {
                // Check if the response is a redirect (e.g., to /user, /technician)
                // If the backend sends a redirect URL, follow it.
                if (res.redirected) {
                    window.location.href = res.url;
                    return; // Stop further execution in this block
                }

                // Otherwise, parse the JSON response
                return res.json();
            })
            .then(data => {
                // This block will execute if there was no redirect and JSON data was received
                if (data) {
                    console.log("Login success/failure response:", data);
                    if (data.success) {
                        // Check for the new 'needsPhoneUpdate' flag
                        if (data.needsPhoneUpdate) {
                            showMessage(data.message || "Please add your phone number to continue.", 'info');
                            setTimeout(() => {
                                window.location.href = '/phone-update';
                            }, 500);
                        } else {
                            // Successful login without redirect (e.g., if already on home page)
                            showMessage(data.message || "Google Sign-In successful!", 'success');
                            document.getElementById('auth-overlay').style.display = 'none';
                            if (data.redirect) {
                                 setTimeout(() => {
                                     window.location.href = data.redirect;
                                 }, 500);
                             }
                        }
                    } else {
                        // Failed login
                        showMessage(data.message || "Google Sign-in failed.", 'error');
                    }
                }
            })
            .catch(err => {
                console.error("Login failed:", err);
                showMessage("Network error during Google Sign-In.", 'error');
            });
        }

        // --- FAQ Accordion Logic ---
        const faqItems = document.querySelectorAll('.faq-item');

        faqItems.forEach(item => {
            const question = item.querySelector('.faq-question');
            const answer = item.querySelector('.faq-answer');
            const icon = item.querySelector('i');

            question.addEventListener('click', () => {
                const isActive = item.classList.contains('active');

                // Close all other open FAQ items
                faqItems.forEach(otherItem => {
                    if (otherItem !== item && otherItem.classList.contains('active')) {
                        otherItem.classList.remove('active');
                        otherItem.querySelector('.faq-answer').style.maxHeight = '0';
                    }
                });

                // Toggle the clicked item's state
                if (isActive) {
                    item.classList.remove('active');
                    answer.style.maxHeight = '0';
                } else {
                    item.classList.add('active');
                    answer.style.maxHeight = answer.scrollHeight + 'px';
                }
            });
        });
        
    </script>
    
    <!-- Google Maps API script - This should only be present if you need other client-side Google Maps functionalities
         (e.g., displaying an actual map). Since our autocomplete is now backend-proxied,
         this script might not be strictly necessary for just location search, but keep it if other parts of your app use it. -->
    <!-- Make sure to replace YOUR_VITE_GOOGLE_MAPS_API_KEY with your actual key! -->
    <!-- <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_VITE_GOOGLE_MAPS_API_KEY&libraries=places&callback=initMap"></script> -->
</body>
</html>
